<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNOMED-UMU</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            font-size: 1rem;
            font-weight: 400;
            line-height: 1.5;
            color: rgb(192, 192, 192);
            text-align: left;
            background-color: rgb(230,230,230);
        }
        
        .cabecera {
            background-color: #fff;
            padding: 1.05em 0;
        }
        
        .franja-pie {
            background-color: #8d1300;
            padding: 2.5em 2.5em 5em 2.5em;
            color: #fff;
            position: absolute;
            width: 100%; 
        }
        
        #logo-snomed img {
            max-width: 100px;
            height: auto; 
        }
        
        .idioma{
            background-color: lightgray;
            height: 40px;
        }
        
        .franja-roja{
            background-color: #8d1300;
            height: 40px;
            
        }
      
		.search-box {
    		margin-left: 20px;
		}

		.search-box input[type="text"] {
    		padding: 8px;
    		border: 1px solid #ccc;
    		border-radius: 5px;
		}

		.search-box button {
    		padding: 8px 16px;
    		background-color: #007bff;
    		color: #fff;
    		border: none;
    		border-radius: 5px;
    		cursor: pointer;
		}
    	.main-content {
      		text-align: center;
    	}
    
    	.main-content h1 {
      		margin-bottom: 20px;
    	}
    
    	.button-container {
      		margin-top: 30px;
    	}
    
    	.button-container a {
      display: inline-block;
      margin: 0 10px;
      padding: 10px 20px;
      background-color: #007bff;
      color: #fff;
      text-decoration: none;
      border-radius: 5px;
      transition: background-color 0.3s;
    }
    
    .button-container a:hover {
      background-color: #0056b3;
    }
    
    
.dropdown-menu {
    display: none;
    position: absolute;
    z-index: 1000;
    background-color: #fff;
    min-width: 160px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
    padding: 0.5rem 0; 
    border-radius: 0.25rem;
    opacity: 0;
    transform: translateY(-10px);
    transition: opacity 0.3s, transform 0.3s;
}

	.dropdown:hover .dropdown-menu {
    	display: block;
    	opacity: 1;
    	transform: translateY(0);
    	transform: translateX(-50px);
	}

	.dropdown-item {
    	display: block;
    	width: 100%;
    	padding: 0.5rem 1rem;
    	clear: both;
    	font-weight: 400;
    	color: #212529;
    	text-align: inherit;
    	white-space: nowrap;
    	background-color: transparent;
    	border: 0;
    	transition: background-color 0.3s;
	}

.dropdown-item:focus, .dropdown-item:hover {
    color: #16181b; 
    text-decoration: none;
    background-color: #f8f9fa;
}

	.panel {
    	max-width: 1100px;
    	width: 100%;
    	margin: 0 auto; 
    	display: flex;
    	flex-direction: column; 
    	justify-content: center;
    	border: 1px solid #ccc;
    	border-radius: 5px;
    	overflow: hidden;
    	box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    	padding: 20px;
    	background-color: white;
    	margin-top: 20px;
    	margin-bottom: 20px;
	}

 		.panel-left {
	 		max-width: 500px;
    		width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-right: 2px solid #ccc;
        }

 		.panel-right {
	 		max-width: 650px;
    		width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right:50px;
        }

		.snomed-logo {
    		height: 200px;
    		width: auto; 
    		margin-top: 40px;
    		margin-bottom: 10px;
		}

		.search-box {
    		margin-left: 20px;
		}

		.search-box input[type="text"] {
    		padding: 8px;
    		border: 1px solid #ccc;
    		border-radius: 5px;
		}

		.search-box button {
    		padding: 8px 16px;
    		background-color: #005164;
    		color: #fff;
    		border: none;
    		border-radius: 5px;
    		cursor: pointer;
    		margin: 10px;
		}
 		.separator {
            height: 100%;
            width: 2px;
            background-color: #ccc;
        }
        .separator_sidebar{
        	margin: 10px 0;
    		border-top: 1px solid #ccc;
        }
        .btn-primary {
    		background-color: #005164;
    		border-color: #002028;
    		color: #FFF;
    		width: 150px;
		}
		.custom-input {
    		margin-bottom: 40px;
    		padding: 10px;
    		border-radius: 5px;
    		border: 2px solid black;
    		width: 100%;
    		background-color: lightgray;
		}

		.custom-input:focus {
    		background-color: white;
		}
		
		.title-container {
			padding-top: 50px;
			color: black;
    		display: flex;
    		justify-content: center;
    		align-items: center;
    		height: 100%;
		}

		.destacado {
    		color: #007f9d;
    		font-size: 18px;
    		font-weight: bold;
		}
		
		.destacado-resultado {
    		color: #005164;
    		font-size: 15px;
    		font-weight: bold;
		}
		.termino-clinico{
			margin-top: 30px;
			color: black; 
			font-weight: bold;
		}

		.resultado{
			text-align:center;
		}
		.termino-clinico #expresion {
   			font-family: Arial, sans-serif;
    		font-size: 14px; 
    		color: #333; 
    	}
 	.modal-header {
      color:  #005164;
    }
    .modal-title {
      font-weight: bold;
    }
    .modal-body {
      padding: 20px;
      background-color: #FFF6D2;
    }
    .modal-footer {
      justify-content: center;
    }
    .modal-footer .btn-secondary {
      background-color: #343a40;
      border: none;
    }
    .modal-footer .btn-secondary:hover {
      background-color: #495057;
    }
    .modal-lg {
      max-width: 150%;
    }
    #myModal .modal-dialog {
    	max-width: 80%;
    	width: 80%;
    	
	}		
	#myModal .modal-content {
    	max-height: 100vh; 
    	overflow-y: auto; 
    }
    
.clinicTerm-lista {
    width: 300px;
    height: 100px;
    overflow-y: auto;
    list-style: none;
    padding: 0;
    border: 1px solid #ccc; 
    background: #eee;
    margin-bottom: 50px;
}

.clinicTerm-lista li {
    padding: 4px;
    margin-bottom: 2px;
    cursor: pointer;
    transition: background-color 0.3s;
    color: black;
    background:white;
}

.clinicTerm-lista li:hover {
    background-color: #f0f0f0;
}

.clinicTerm-lista li.selected {
    background-color: lightgreen;
}

    .relacion-lista {
   		height: 100px;
    	overflow-y: auto;
}
    
   .relacion-lista {
    list-style: none;
    padding: 0;
    border: 1px solid #ccc; 
    background:#eee;
}

.relacion-lista li {
    padding: 4px;
    margin-bottom: 2px;
    cursor: pointer;
    transition: background-color 0.3s;
    color: black;
    background:white;
}

.relacion-lista li:hover {
    background-color: #f0f0f0;
}

.relacion-lista li.selected {
    background-color: lightgreen;
}

.switch {
    position: relative;
    display: inline-block;
    width: 30px;
    height: 17px;
    margin-left:5px;
    margin-top:8px;
}

.switch input { 
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 17px;
    
}

.slider:before {
    position: absolute;
    content: "";
    height: 13px;
    width: 13px;
    left: 2px;
    bottom: 2px;
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .slider {
    background-color: #2196F3;
}

input:focus + .slider {
    box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
    -webkit-transform: translateX(13px);
    -ms-transform: translateX(13px);
    transform: translateX(13px);
}

.slider.round {
    border-radius: 17px;
}

.slider.round:before {
    border-radius: 50%;
}


    .btn-secondary {
      background-color: transparent;
      border: none;
      color: white;
    }
    
	.btn-secondary:hover {
    	background-color: #005164; 
	}
    
   .sidebar {
    height: 100%;
    width: 220px;
    position: fixed;
    top: 0;
    left: -220px;
    background-color: #005164;
    overflow-x: hidden;
    transition: 0.5s;
    padding-top: 60px;
    z-index: 1001;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

.sidebar a {
    padding: 10px 20px; 
    text-decoration: none;
    font-size: 16px;
    color: white;
    display: block;
    transition: 0.3s;
}

.sidebar summary {
    padding: 10px 20px;
    text-decoration: none;
    font-size: 16px;
    color: white;
    display: block;
    transition: 0.3s;
}

.sidebar a:hover {
    background-color: #008080; 
}

.sidebar summary:hover {
    background-color: #008080;
}


.sidebar .closebtn {
    position: absolute;
    top: 10px; 
    right: 15px;
    font-size: 24px;
    color: white;
}

    
   .crear-proyecto-container {
    position: sticky;
    bottom: 0;
    background-color: #005164;
    padding: 10px;
    text-align: center;
    border: 1px solid transparent;
    z-index: 1000;
}

.crear-proyecto-container {
    display: flex;
    justify-content: center;
    margin-top: 20px;
}

.crear-proyecto-btn {
    background-color: #005164;
    color: white;
    border: 1px solid transparent;
    padding: 10px 20px;
    cursor: pointer; 
    transition: 0.3s;
}
    
.crear-proyecto-btn:hover {
    background-color: #008080;
    border: 1px solid #fff; 
}    
.modal-crearProyecto {
  display: none;
  position: fixed;
  z-index: 1100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, 0.4);
}

.modal-crearProyecto-content {
  background-color: #fefefe;
  margin: 15% auto;
  padding: 20px;
  border-radius: 5px;
  max-width: 500px;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: black;
  text-decoration: none;
  cursor: pointer;
}

.titulo-crearProyecto {
  margin-top: 40px;
  color: #005164;
  text-align: center;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 20px;
}

input[type="text"] {
  width: 100%;
  padding: 10px;
  border: 1px solid #ccc;
  border-radius: 5px;
}

.miembros-dropdown {
    display: none;
    width: 450px;
    position: absolute;
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 5px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
    overflow-y: auto;
    max-height: 160px; 
}

.miembro-dropdown-item {
    padding: 10px 15px;
    cursor: pointer;
    border-bottom: 1px solid #e0e0e0; 
    background-color: #ffffff;
    transition: background-color 0.3s ease, color 0.3s ease;
    font-family: Arial, sans-serif;
    font-size: 14px;
    color: #333333;
}

.miembro-dropdown-item:hover {
    background-color: #f1f1f1;
    color: #000000; 
}

.miembro-dropdown-item:active {
    background-color: #e0e0e0;
    color: #000000;
}

.miembro-dropdown-item:first-child {
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
}

.miembro-dropdown-item:last-child {
    border-bottom-left-radius: 4px; /* Rounded bottom corners for the last item */
    border-bottom-right-radius: 4px;
    border-bottom: none; /* Remove bottom border for the last item */
}


.miembros-añadidos {
  border: 1px solid #ccc;
  padding: 10px 15px; /* Increased horizontal padding for better spacing */
  border-radius: 8px; /* Slightly larger border radius for a smoother look */
  min-height: 50px;
  max-height: 200px; /* Added max-height to limit the size */
  overflow-y: auto;
  background-color: #ffffff; /* Changed to pure white for a cleaner look */
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Added subtle shadow for depth */
  font-family: Arial, sans-serif; /* Consistent font family */
  font-size: 14px; /* Set a font size */
  color: #333333; /* Text color */
  margin-top: 10px; /* Added margin to separate from other elements */
}

/* Optional: Style the scrollbar for a better look */
.miembros-añadidos::-webkit-scrollbar {
  width: 8px;
}

.miembros-añadidos::-webkit-scrollbar-thumb {
  background-color: #ccc;
  border-radius: 4px;
}

.miembros-añadidos::-webkit-scrollbar-thumb:hover {
  background-color: #b3b3b3;
}

.miembros-añadidos::-webkit-scrollbar-track {
  background-color: #f1f1f1;
}


.panel-tipoEdicion {
  background-color: #f9f9f9;
  border: 1px solid #ccc;
  padding: 20px;
  border-radius: 5px;
  margin: 20px auto;
}

.panel-tipoEdicion label {
    display: block;
    margin-bottom: 10px;
    color: #005164;
}

.panel-tipoEdicion input[type="text"] {
    width: 100%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 5px;
    margin-bottom: 15px;
    box-sizing: border-box;
}

#panel-eliminar-relaciones {
    display: flex;
    flex-direction: column;
}

#lista-relaciones {
    margin-bottom: 15px;
}

.concepto-relacion {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

#concepto-relacion {
    width: 60%;
}

.boton_crearProyecto{
	display: flex;
    justify-content: center;
    align-items: center;
}

/* Container styling for the list group */
.list-group {
    padding: 0;
    margin: 20px 0;
    list-style: none;
    border: 1px solid #ccc;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    background-color: #f9f9f9;
}

/* Styling for the list group items */
.list-group-item {
    padding: 10px 15px;
    border-bottom: 1px solid #ddd;
    background-color: #ffffff;
    transition: background-color 0.3s ease, color 0.3s ease;
    font-family: Arial, sans-serif;
    font-size: 14px;
    color: #333333;
    cursor: pointer;
}

.list-group-item:hover {
    background-color: #f1f1f1;
    color: #000000;
}

.list-group-item:active {
    background-color: #e0e0e0;
    color: #000000;
}

.list-group-item.selected {
    background-color: #d41f4e;
    color: #000000;
}

/* Styling for the first and last items to round the corners */
.list-group-item:first-child {
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
}

.list-group-item:last-child {
    border-bottom-left-radius: 8px;
    border-bottom-right-radius: 8px;
    border-bottom: none;
}

.list-group::-webkit-scrollbar {
    width: 8px;
}

.list-group::-webkit-scrollbar-thumb {
    background-color: #ccc;
    border-radius: 4px;
}

.list-group::-webkit-scrollbar-thumb:hover {
    background-color: #b3b3b3;
}

.list-group::-webkit-scrollbar-track {
    background-color: #f1f1f1;
}

.concepto-relacion {
    margin-top: 40px;
    margin-right:50px;
}

.concepto-relacion .form-control {
    display: block;
    width: 100%;
    padding: 10px;
    font-size: 14px;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 4px;
    box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.075);
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
}

.concepto-relacion .form-control:focus {
    border-color: #80bdff;
    outline: 0;
    box-shadow: 0 0 5px rgba(128, 189, 255, 0.5);
}



 </style>
 </head>
<body>


<header class="header">
    <div class="cabecera">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8 text-center text-md-left" id="logo-snomed">
                    <a class="um-lr-gtm-principal-cabecera-logo-um">
                        <img itemprop="logo" src="../imagenes/snomed.png" alt="Logo SNOMED-UMU">
                    </a>
                </div>
                <div class="col-md-4 text-center text-md-right" id="logo-um">
                    <a class="um-lr-gtm-principal-cabecera-logo-um">
                        <img itemprop="logo" src="https://www.um.es/o/um-lr-principal-um-home-theme/images/logo-um.png" alt="Logo Universidad de Murcia">
                    </a>
                </div>
            </div>
        </div>
    </div>
</header>

<div class="franja-roja">
    <div class="container">
        <div class="row align-items-center justify-content-between">
            <div class="col-md-4">
                <button style="display: inline-block;" id="proyecto_actual" class="btn btn-secondary" onclick="openSidebar()">Área Personal</button>
                <img id="añadir_miembro"  style="height:40px; display:none;" src="../imagenes/anadir.png" alt="Añadir Miembro" onclick="añadirMiembros()">
            </div>
            <div class="col-md-4 d-flex justify-content-center align-items-center">
                <label style="color: white; margin-top: 8px;" id="modo"></label>
                <label class="switch">
                    <input id="modo-edicion" type="checkbox" onchange="togglePanel()">
                    <div class="slider round"></div>
                </label>
            </div>
            <div class="col-md-4 d-flex justify-content-end align-items-center">
                <div class="dropdown accesos__p accesos__p--margen" id="language-selector">
                    <a class="pb-0 pt-0 menu-accesible__b dropdown-toggle" role="button" href="#" id="language-selector__button" aria-haspopup="true" aria-expanded="false" style="color: white;">Español <i class="fas fa-chevron-down" aria-hidden="true" title="Desplegar submenú de idioma"></i><span class="sr-only">Desplegar submenú de idioma</span></a>
                    <div class="dropdown-menu menu-accesible__c" aria-labelledby="language-selector__button">
                        <a class="dropdown-item" href="#" onclick="changeLanguageDropdown()">Inglés</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


 <div id="mySidebar" class="sidebar">
  </div>

<div id="modal-crearProyecto" class="modal-crearProyecto">
  <div class="modal-crearProyecto-content">
    <span class="close" onclick="cerrarModal()">&times;</span>
    <h2 class="titulo-crearProyecto" id="titulo-crearProyecto"></h2>
    <form>
      <div class="form-group">
        <label style="color:black;" for="nombreProyecto" id="nombre-crearProyecto"></label>
        <input type="text" id="nombreProyecto" name="nombreProyecto" class="form-control">
      </div>
      <div class="form-group">
        <label style="color:black;" for="buscarMiembros" id="buscar-crearProyecto"></label>
        <input type="text" id="buscarMiembros" name="buscarMiembros" onkeyup="mostrarMiembrosDropdown()" class="form-control">
        <div id="miembrosDropdown" class="miembros-dropdown"></div>
        
      </div>
      <div class="form-group">
        <label style="color:black;" for="miembrosProyecto" id="miembros-crearProyecto"></label>
        <div id="miembrosAñadidos" class="miembros-añadidos"></div>
      </div>
      <div class="boton_crearProyecto">
      	<button class="btn btn-primary btn-crear" type="button" onclick="crear()" id="crear-crearProyecto"></button>
      </div>
    </form>
  </div>
</div>

<div id="modal-añadirMiembros" class="modal-crearProyecto">
  <div class="modal-crearProyecto-content">
    <span class="close" onclick="cerrarModal_añadir()">&times;</span>
    <h2 class="titulo-crearProyecto" id="titulo-anadirProyecto"></h2>
    <form>
      <div class="form-group">
        <label style="color:black;" for="nombreProyecto" id="nombre-anadirProyecto"></label>
        <input type="text" id="nombreAñadir" name="nombreProyecto" class="form-control">
      </div>
      <div class="form-group">
        <label style="color:black;" for="buscarMiembros" id="buscar-anadirProyecto"></label>
        <input type="text" id="buscarAñadirMiembros" name="buscarMiembros" onkeyup="mostrarMiembrosAñadirDropdown()" class="form-control">
       <div id="miembrosDropdown-añadir" class="miembros-dropdown"></div>
      </div>
      <div class="form-group">
        <label style="color:black;" for="miembrosProyecto" id="miembros-anadirProyecto"></label>
      <div id="miembrosAñadidosAñadir" class="miembros-añadidos"></div>
      </div>
      <div class="boton_crearProyecto">
      	<button class="btn btn-primary btn-crear" type="button" onclick="añadir()" id="crear-anadirProyecto"></button>
      </div>
    </form>
  </div>
</div>

<div class="panel" id="panel-edicion" style="display:none;">
    <div class="row">
        <div class="col-md-6">
            <div class="panel-left">
               <div class="snomed">
            		<a class="snomed">
                		<img itemprop="logo" src="../imagenes/snomed.png" alt="Logo SNOMED-UMU" class="snomed-logo">
            		</a>
        		</div>
        		<h2 style="font-weight: bold; font-size: 1.5rem; color: black;" id="titulo1-b"></h2>
        		<div style="text-align: center;">
            		<p style="color: black; margin-top:40px;" id="titulo10"></p>
 					<ul id="clinicTerm-lista" class="clinicTerm-lista">
    				</ul>
        		</div>
            </div>
        </div>
         <div class="col-md-6">
        	<div class="panel-right" id="panel-right-edicion" style="display: none;">
    			<div class="title-container">
        			<h2 id="modo-1"></h2>
    			</div>
    			<div class="termino-clinico">
    				<p id="termino-clinico-e" style="display: inline-block;"></p>
    				<span class="destacado" id="texto-mostrado-e"></span>
    				<br>
    				<p id="usuario-e" style="display: inline-block; font-size: small;"></p>
    				<span class="destacado" id="texto-usuario-e" style="font-size: small;"></span>
				</div>
    			<div class="resultado">
    			<div class="termino-clinico">
        			<p id="resultado-e"></p>
        			<p style="font-size: 12px;" id="expresion-e"></p>
    			</div>
    			<div class="button-container">
    				<button class="btn-primary rounded" id="boton-e" data-toggle="modal" data-target="#myModal">Generar Diagrama</button>
    			</div>
			</div>
			<div class="form-group">
    			<label style="margin-top:20px; text-align: center; color:#005164; margin-left:160px;" for="selector-opciones" id="selector-edicion"></label>
    			<select style="width: 200px; margin: 0 auto;" class="form-control" id="selector-opciones" onchange="mostrarPanelTipoEdicion()">
        			<option value="seleccionar" id="seleccion-edicion"></option>
        			<option value="tipo-semantico" id="tipoSemantico-edicion"></option>
        			<option value="eliminar-relaciones" id="eliminar-edicion"></option>
        			<option value="añadir-relaciones" id="anadir-edicion"></option>
    			</select>
			</div>
			<div id="panel-tipo-semantico" class="panel-tipoEdicion" style="display: none;">
   				<div style="display: flex; justify-content: space-between; align-items: center;">
        			<div>
            			<label for="tipo-semantico" id="tipoSemantico-edicion2"></label>
            			<input type="text" class="form-control" id="tipo-semantico" value="">
        			</div>
        				<button style="margin-top: 20px;"class="btn btn-primary" onclick="editarTipoSemantico()" id="editar-tipoSemantico"></button>
    			</div>
    		</div>
			<div id="panel-eliminar-relaciones" class="panel-tipoEdicion" style="display: none;">
    			<label id="relaciones-edicion"></label>
    			<ul id="lista-relaciones-eliminar" class="list-group">    
    			</ul>
    			<div class="concepto-relacion">
        			<label for="concepto-relacion" id="concepto-asociado-edicion"></label>
        			<input  type="text" style="margin-left: 20px;" class="form-control" id="concepto-EliminarRelacion" readonly>
        			<button style="margin-left: 30px; margin-top:-20px;" class="btn btn-primary" onclick="eliminarRelacion()" id="editar-eliminarRelacion">Eliminar</button>
    			</div>
			</div>

		</div>

			<div id="panel-añadir-relaciones" class="panel-tipoEdicion" style="display: none;">
    <label id="relaciones-edicion1"></label>
    <form>
        <div class="form-group">
            <label style="color:black;" for="buscarRelaciones" id="buscar-relaciones"></label>
            <input type="text" id="buscarRelaciones" name="buscarRelaciones" onkeyup="mostrarRelacionesDropdown()" class="form-control">
            <div id="relacionesDropdown" class="relaciones-dropdown"></div>
        </div>
        <div class="form-group">
            <label style="color:black;" for="conceptoAsociado" id="concepto-asociado1"></label>
            <select id="conceptoAsociado" name="conceptoAsociado" class="form-control">
                
            </select>
        </div>
        <div class="boton_crearProyecto">
            <button class="btn btn-primary btn-crear" type="button" onclick="añadir_Relacion()" id="crear-anadirRelacion"></button>
        </div>
    </form>
</div>
			</div>
    	</div>
       </div>
</div>

<div class="panel" id="panel-generacion">
    <div class="row">
        <div class="col-md-6">
            <div class="panel-left">
               <div class="snomed">
            		<a class="snomed">
                		<img itemprop="logo" src="../imagenes/snomed.png" alt="Logo SNOMED-UMU" class="snomed-logo">
            		</a>
        		</div>
        		<h2 style="font-weight: bold; font-size: 1.5rem; color: black;" id="titulo"></h2>
        		<div class="search-box" style="text-align: center;">
            		<p style="color: black; margin-top: 70px;" id="titulo2"></p>
            			<input  class="custom-input" id="input-text" type="text" placeholder="Escriba aquí...">
            		<p style="color: black;" id="titulo3"></p>
            		<div class="button-container">
                		<button class="btn-primary" id="boton1" onclick="validateInput('automatica')"></button>
                		<button class="btn-primary" id="boton2" onclick="validateInput('guiada')"></button>
            		</div>
        		</div>
            </div>
        </div>
        <div class="col-md-6">
    		<div class="panel-right" id="panel-right-guiada" style="display: none;">
    			<div class="title-container">
        			<h2 id="generacion-g"></h2>
    		</div>
    		<div class="termino-clinico">
        		<p id="termino-clinico" style="display: inline;"> </p><span class="destacado" id="texto-mostrado-g"></span>
    		</div>
     <div class="row">
        <div class="col-md-6">
            <div class="tipo-semantico" style="margin-top: 20px;">
                <p style="color: black;" id="titulo4"></p>
                <select id="tipo-semantico-select" class="custom-select" onchange="habilitarReferencia()">
                    <option id="titulo-s" value="seleccion"></option>
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div id="concepto-referencia" style="margin-top: 20px;">
                <p style="color: black;" id="titulo5"></p>
                <select id="concepto-referencia-select" class="custom-select" onchange="habilitarRelacion()" disabled>
                    <option id="titulo-s1" value="seleccion1"></option>
                </select>
            </div>
        </div>
    </div>
<div class="row">
    <div class="col-md-6" style="margin-top: 20px;">
    	<p style="color: black;" id="titulo6"></p>
 		<ul id="relacion-lista" class="relacion-lista">
    	</ul>
    </div>
    <div class="col-md-6"  style="margin-top: 20px;">
        <p style="color: black;" id="titulo7"></p>
 		<ul id="concepto-lista" class="relacion-lista">
    	</ul>
    </div>
</div>
    <div class="row">
    	<div class="col-md-6">
        	<p style="color: black;font-size:12px; text-align:center; text-decoration: underline; cursor: pointer;" onclick="borrarTodoMapa()">Borrar todas las selecciones</p>
    	</div>
    
    	<div class="col-md-6">
        	<p style="color: black;font-size:12px; text-align:center; text-decoration: underline; cursor: pointer;" onclick="borrarEntradaRelacion()">Borrar la selección de concepto</p>
    	</div>
</div>
<div class="row">
    <div class="col text-center" style="margin-left: 170px;">
        <button class="btn-primary rounded" id="boton-generar-e" style="display:none;" onclick="generarExpresionguiada()">Generar Expresión Guiada</button>
    </div>
</div>

    	<div class="resultado">
    		<div class="termino-clinico">
        		<p id="resultado1"></p>
        		<p id="expresion-g"></p>
    		</div>
    		<div class="button-container d-flex justify-content-center"">
    			<button class="btn-primary rounded mr-4" id="boton-editar-2" style="display:none;" onclick="togglePanelEdit()"></button>	
        		<button class="btn-primary rounded" id="boton3" style="display:none;" data-toggle="modal" data-target="#myModal">Generar Diagrama</button>
    		</div>
		</div>
		</div>
    		<div class="panel-right" id="panel-right-automatica" style="display: none;">
       	 		<div class="title-container">
        			<h2 id="generacion-a"></h2>
    			</div>
    			<div class="termino-clinico">
        			<p id="termino-clinico1" style="display: inline;"></p><span class="destacado" id="texto-mostrado-a"></span>
    			</div>
    	    <div class="resultado">
    			<div class="termino-clinico">
        			<p id="resultado"></p>
        			<p id="expresion"></p>
    			</div>
    			<div class="button-container">
    				<button class="btn-primary rounded" id="boton-editar-1" onclick="togglePanelEdit()"></button>
        			<button class="btn-primary rounded" id="boton31" data-toggle="modal" data-target="#myModal"></button>
    			</div>
			</div>
    		</div>
		</div>
    </div>
</div>

<footer class="container-fluid franja-pie um" style="color: white;">
    <div class="caja-pie">
        <section id="pie">
            <div class="banda-pie row">
                <div class="col-md-7">
                    <div id="logo-um-pie" class="d-flex">
                        <a class="um-lr-gtm-principal-pie-logo" href="/" data-senna-off="true">
                            <img class="img-responsive" src="https://www.um.es/o/um-lr-principal-um-home-theme/images/logo-universidad-de-murcia-blanco.png" alt="Logo Universidad de Murcia">
                        </a>
                    </div>
                </div>
            </div> 
            <div style="margin-top:50px;" class="row">
                <div class="col-sm-6 copyright-pie">
                    <p class="copyright-pie-titulo text-uppercase" id="copyright-title"></p>
                    <p id="address" style="color: white" >
                </div>
                <div class="col-md-6 como-llegar-pie"> 
                    <p>
                        <a href="https://www.um.es/departamentos" style="color: white;" id="departments-link" class="um-lr-gtm-principal-pie-departamentos"></a> -
                        <a href="https://www.um.es/servicios" style="color: white;" id="services-link" class="um-lr-gtm-principal-pie-servicios"></a>
                    </p>
                    <p >
                        <a href="https://general.um.es/general/inspeccion.buzon" style="color: white;" id="mailbox-link" class="um-lr-gtm-principal-pie-buzon"></a> -
                        <a href="https://www.um.es/web/universidad/buzon-del-informante" style="color: white;" id="informant-mailbox-link" class="um-lr-gtm-principal-pie-buzon-informante"></a> -
                        <a href="https://www.um.es/web/universidad/lucha-contra-el-fraude" style="color: white;" id="fraud-link" class="um-lr-gtm-principal-pie-fraude"></a>-
                        <a href="http://dumbo.um.es/" style="color: white;" id="dumbo-link" class="um-lr-gtm-principal-pie-dumbo"></a>
                    </p>
                    <p>
                        <a href="https://www.um.es/web/universidad/accesibilidad" style="color: white;" id="accessibility-link" class="um-lr-gtm-principal-pie-accesibilidad"></a> -
                        <a href="https://www.um.es/web/universidad/contenido/como-llegar" style="color: white;" id="how-to-get-link" class="um-lr-gtm-principal-pie-como-llegar"></a> -
                        <a href="https://www.um.es/web/emergencias" style="color: white;" id="emergencies-link" class="um-lr-gtm-principal-pie-emergencias"></a> -
                        <a href="https://www.um.es/web/ayuda/" style="color: white;" id="help-link" class="um-lr-gtm-principal-pie-ayuda"></a>
                    </p>
                </div>
            </div>
        </section>
    </div>
</footer>

<div class="modal" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
    
     <div class="modal-header">
        <h4 class="modal-title" id="titulo-diagrama"></h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      
      <div class="modal-body">
        
      </div>
      
      <div class="modal-footer">
        <button type="button" id="cerrar-diagrama" class="btn btn-secondary" data-dismiss="modal"></button>
      </div>
      
    </div>
  </div>
</div>



<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<script>

	var language='es';
	var clinicTerm;
	var semanticType;
	var referenceConcept;
	var expresiones_edicion = [];
	var expresion_actual = {};
	var id_actual;
	
	
	document.addEventListener('DOMContentLoaded', (event) => {
	    comprobarUsuario();
	});

	function comprobarUsuario() {
	    const currentUrl = window.location.href;
	    const url = new URL(currentUrl);
	    const searchParams = url.searchParams;

	    // Comprobar si la URL contiene email y que no es null
	    if (searchParams.has('email') && searchParams.get('email') &&
	    		searchParams.has('password') && searchParams.get('password')) {
	        const email = searchParams.get('email');
	        const password = searchParams.get('password');
			
	        iniciar_sesion(email, password);
	        
	   	} else {
	   		alert('Credenciales incorrectas.');
  			window.location.href = 'login.html';
	    }
	}
	
	function iniciar_sesion(email, password){
	  	  const url = `http://localhost:8091/usuarios/verificar/${email}/${password}`;	
			
	      fetch(url)
	         .then(response => {
	    		if (response.ok) {
	      			return response.text();
	    		}
	    		window.location.href = 'login.html';
	  		})
	  		.then(data => {
	    		if (data === email) {
	      			
	    		} else {
	      			alert('Credenciales incorrectas. Por favor, inténtelo de nuevo.');
	      			window.location.href = 'login.html';
	    		}
	  		})
	        .catch(error => {
	          console.error('Error:', error);
	          alert('Error en el registro. Por favor, inténtelo de nuevo.');
	        });
	  }

    function changeLanguage(languageCode) {
       
       var texts_es = {
    		'copyright-title': 'Universidad de Murcia',
    		'address': 'Avda. Teniente Flomesta, 5 · 30003 · Murcia<br> Teléfono: <a style="color: white" href="tel:+34868883000">+34 868 88 3000</a> (Centralita) / <a style="color: white" href="tel:+34868888888">+34 868 88 8888</a> (Información)',
    		'departments-link': 'Departamentos',
    		'services-link': 'Servicios',
    		'mailbox-link': 'Buzón Universitario',
    		'informant-mailbox-link': 'Buzón del Informante',
    		'fraud-link': 'Lucha contra el fraude',
    		'dumbo-link': 'Sistema DUMBO',
    		'accessibility-link': 'Accesibilidad',
    		'how-to-get-link': 'Cómo llegar',
    		'emergencies-link': 'Emergencias',
    		'help-link': 'Ayuda',
    		'language-selector__button': 'Español',
    		'dropdown-item': 'Inglés',
    		'dropdown-item-text': 'English',
    		'titulo': '¡Bienvenidos a SNOMED-UMU!',
    		'titulo1-b': '¡Bienvenidos a SNOMED-UMU!',
    		'titulo2': 'Escriba para generar la expresión postcoordinada:',
    		'titulo3': 'Seleccione el tipo de generación:',
    		'boton1': 'Automática',
    		'boton2': 'Guiada',
    		'placeholder-input': 'Escriba aqui...',
    		'resultado': 'Expresión PostCoordinada:',
    		'resultado1': 'Expresión PostCoordinada:',
    		'resultado-e': 'Expresión PostCoordinada:',    		    		
    		'generacion-g': 'Generación Guiada',
    		'generacion-a': 'Generación Automática',
    		'termino-clinico' : 'Termino Clínico: ',
    		'termino-clinico-e' : 'Termino Clínico: ',
    		'termino-clinico1' : 'Termino Clínico: ',
    		'boton3': 'Generar Diagrama',
    		'boton31': 'Generar Diagrama',
    		'boton-e': 'Generar Diagrama',
    		'boton-editar-1': 'Editar',
    		'boton-editar-2': 'Editar',
    		'boton-generar-e': 'Generar Expresión',
    		'titulo4': 'Seleccione un tipo semántico: ',
    		'titulo5': 'Sel. un concepto de referencia: ',
    		'titulo6': 'Seleccione una relación: ',
    		'titulo7': 'Seleccione un concepto: ',
    		'titulo10': 'Selecciona un término clínico: ',
    		'titulo-s': 'Selecciona... ',
			'titulo-s1': 'Selecciona... ',
			'titulo-s2': 'Selecciona... ',
			'titulo-s3': 'Selecciona... ',
			'modo': 'Modo Edición: ',
			'modo-1': 'Modo Edición ',
			'area-Personal': 'Área Personal',
			'mis-projectos': 'Mis Projectos',
			'titulo-diagrama': 'Diagrama',
			'cerrar-diagrama': 'Cerrar',
			'titulo-crearProyecto': 'Crear Proyecto',
			'nombre-crearProyecto': 'Nombre del Proyecto',
			'buscar-crearProyecto': 'Buscar Usuarios',
			'miembros-crearProyecto': 'Miembros Añadidos',
			'crear-crearProyecto': 'Crear',
			'titulo-anadirProyecto': 'Añadir Miembros',
			'nombre-anadirProyecto': 'Nombre del Proyecto',
			'buscar-anadirProyecto': 'Buscar Usuarios',
			'miembros-anadirProyecto': 'Miembros Añadidos',
			'crear-anadirProyecto': 'Añadir',
			'selector-edicion': 'Editar:',
			'seleccion-edicion': 'Selecciona...',
			'tipoSemantico-edicion': 'Tipo Semántico',
			'eliminar-edicion': 'Eliminar Relaciones',
			'anadir-edicion': 'Añadir Relaciones',
			'tipoSemantico-edicion2': 'Tipo Semántico',
			'editar-tipoSemantico': 'Editar',
			'relaciones-edicion': 'Relaciones:',
			'concepto-asociado-edicion': 'Concepto:',
			'concepto-asociado1': 'Conceptos Asociados:',
			'editar-eliminarRelacion': 'Editar',
			'buscar-relaciones': 'Buscar Relaciones',
			'crear-anadirRelacion': 'Editar',
			'usuario-e': 'Creado Por: '
		};
       
		var texts_en = {
    		'copyright-title': 'University of Murcia',
    		'address': 'Avda. Teniente Flomesta, 5 · 30003 · Murcia<br> Phone: <a style="color: white" href="tel:+34868883000">+34 868 88 3000</a> (Switchboard) / <a style="color: white" href="tel:+34868888888">+34 868 88 8888</a> (Information)',
    		'departments-link': 'Departments',
    		'services-link': 'Services',
    		'mailbox-link': 'University Mailbox',
    		'informant-mailbox-link': 'Informant Mailbox',
    		'fraud-link': 'Fraud Prevention',
    		'dumbo-link': 'DUMBO System',
    		'accessibility-link': 'Accessibility',
    		'how-to-get-link': 'How to Get There',
    		'emergencies-link': 'Emergencies',
    		'help-link': 'Help',
    		'language-selector__button': 'English',
    		'dropdown-item': 'Spanish',
    		'dropdown-item-text': 'Español',
    		'titulo': 'Welcome to SNOMED-UMU!',
    		'titulo1-b': 'Welcome to SNOMED-UMU!',
    		'titulo2': 'Type to generate the postcoordinated expression:',
    		'titulo3': 'Select the type of generation:',
    		'boton1': 'Automatic',
    		'boton2': 'Guided',
    		'placeholder-input': 'Type here...',
    		'resultado': 'PostCoordinated Expression:',
    		'resultado1': 'PostCoordinated Expression:',
    		'resultado-e': 'PostCoordinated Expression:',
    		'generacion-g': 'Guided Generation',
    		'generacion-a': 'Automatic Generation',
    		'termino-clinico' : 'Clinic Term: ',
    		'termino-clinico-e' : 'Clinic Term: ',
    		'termino-clinico1' : 'Clinic Term: ',
    		'boton3': 'Generate Diagram',
    		'boton31': 'Generate Diagram',
    		'boton-e': 'Generate Diagram',
    		'boton-editar-1': 'Edit',
    		'boton-editar-2': 'Edit',
    		'boton-generar-e': 'Generate Expression',
    		'titulo4': 'Select a semantic type: ',
    		'titulo5': 'Select a reference concept: ',
    		'titulo6': 'Select a relation: ',
    		'titulo7': 'Select a concept: ',
    		'titulo10': 'Select a clinic term: ',
			'titulo-s': 'Select... ',
			'titulo-s1': 'Select... ',
			'titulo-s2': 'Select... ',
			'titulo-s3': 'Select... ',
			'modo': 'Edition Mode: ',
			'modo-1': 'Edition Mode ',
			'area-Personal': 'Personal Area',
			'mis-projectos': 'Mis Proectos',
			'titulo-diagrama': 'Diagram',
			'cerrar-diagrama': 'Close',
			'titulo-crearProyecto': 'Create Project',
			'nombre-crearProyecto': 'Project Name',
			'buscar-crearProyecto': 'Browse Users',
			'miembros-crearProyecto': 'Added Members',
			'crear-crearProyecto': 'Create',
			'titulo-anadirProyecto': 'Add Members',
			'nombre-anadirProyecto': 'Project Name',
			'buscar-anadirProyecto': 'Browse Users',
			'miembros-anadirProyecto': 'Added Members',
			'crear-anadirProyecto': 'Add',
			'selector-edicion': 'Edit:',
			'seleccion-edicion': 'Select...',
			'tipoSemantico-edicion': 'Semantic Type',
			'eliminar-edicion': 'Delete Relations',
			'anadir-edicion': 'Add Relations',
			'tipoSemantico-edicion2': 'Semantic Type',
			'editar-tipoSemantico': 'Edit',
			'relaciones-edicion': 'Relations:',
			'concepto-asociado-edicion': 'Concept:',
			'concepto-asociado1': 'Associated Concepts:',
			'editar-eliminarRelacion': 'Edit',
			'buscar-relaciones': 'Browse Relations',
			'crear-anadirRelacion': 'Edit',
			'usuario-e': 'Create By: '
		};
	
       language = languageCode;
       
       var texts = languageCode === 'en' ? texts_en : texts_es;

       var projectButton = document.getElementById('proyecto_actual');
       if (projectButton && ( projectButton.textContent == 'Área Personal' || projectButton.textContent == 'Personal Area')) {
           projectButton.textContent = texts['area-Personal'];
       }
       
        var languageButton = document.getElementById('language-selector__button');
        if (languageButton) {
            languageButton.textContent = texts['language-selector__button'];
        }

        var dropdownItem = document.querySelector('.dropdown-item');
        if (dropdownItem) {
            dropdownItem.textContent = texts['dropdown-item'];
        }

       var dropdownMenu = document.querySelector('.dropdown-menu');
       if (dropdownMenu) {
            dropdownMenu.setAttribute('aria-label', texts['dropdown-item-text']);
       }

       for (var key in texts) {
            if (texts.hasOwnProperty(key)) {
                var element = document.getElementById(key);
                if (element) {
                    element.innerHTML = texts[key];
                }
            }
        }
        
        var inputElement = document.getElementById('input-text');
    	if (inputElement) {
        	inputElement.placeholder = texts['placeholder-input'];
    	}
    	    	
    	var titulo_diagrama = document.getElementById('titulo-diagrama');
        titulo_diagrama.textContent = texts['titulo-diagrama'];
    	
        var cerrar_diagrama = document.getElementById('cerrar-diagrama');
        cerrar_diagrama.textContent = texts['cerrar-diagrama'];  
        
        var titulo_crearProyecto = document.getElementById('titulo-crearProyecto');
        titulo_crearProyecto.textContent = texts['titulo-crearProyecto'];  
        
        var nombre_crearProyecto = document.getElementById('nombre-crearProyecto');
        nombre_crearProyecto.textContent = texts['nombre-crearProyecto']; 
        
        var buscar_crearProyecto = document.getElementById('buscar-crearProyecto');
        buscar_crearProyecto.textContent = texts['buscar-crearProyecto']; 
        
        var miembros_crearProyecto = document.getElementById('miembros-crearProyecto');
        miembros_crearProyecto.textContent = texts['miembros-crearProyecto'];  
        
        var crear_crearProyecto = document.getElementById('crear-crearProyecto');
        crear_crearProyecto.textContent = texts['crear-crearProyecto'];
        
    
        var titulo_anadirProyecto = document.getElementById('titulo-anadirProyecto');
        titulo_anadirProyecto.textContent = texts['titulo-anadirProyecto']; 
        
        var nombre_anadirProyecto = document.getElementById('nombre-anadirProyecto');
        nombre_anadirProyecto.textContent = texts['nombre-anadirProyecto'];         
        
        var buscar_anadirProyecto = document.getElementById('buscar-anadirProyecto');
        buscar_anadirProyecto.textContent = texts['buscar-anadirProyecto']; 
        
        var miembros_anadirProyecto = document.getElementById('miembros-anadirProyecto');
        miembros_anadirProyecto.textContent = texts['miembros-anadirProyecto'];  
        
        var crear_anadirProyecto = document.getElementById('crear-anadirProyecto');
        crear_anadirProyecto.textContent = texts['crear-anadirProyecto'];

        
        var selector_edicion = document.getElementById('selector-edicion');
        selector_edicion.textContent = texts['selector-edicion']; 
        
        var seleccion_edicion = document.getElementById('seleccion-edicion');
        seleccion_edicion.textContent = texts['seleccion-edicion'];         
        
        var tipoSemantico_edicion = document.getElementById('tipoSemantico-edicion');
        tipoSemantico_edicion.textContent = texts['tipoSemantico-edicion']; 
        
        var eliminar_edicion = document.getElementById('eliminar-edicion');
        eliminar_edicion.textContent = texts['eliminar-edicion'];  
        
        var anadir_edicion = document.getElementById('anadir-edicion');
        anadir_edicion.textContent = texts['anadir-edicion'];
        
        
        
        
        
        var tipoSemantico_edicion2 = document.getElementById('tipoSemantico-edicion2');
        tipoSemantico_edicion2.textContent = texts['tipoSemantico-edicion2']; 
        
        var editar_tipoSemantico = document.getElementById('editar-tipoSemantico');
        editar_tipoSemantico.textContent = texts['editar-tipoSemantico'];         
        
        var relaciones_edicion = document.getElementById('relaciones-edicion');
        relaciones_edicion.textContent = texts['relaciones-edicion']; 
        
        var concepto_asociado_edicion = document.getElementById('concepto-asociado-edicion');
        concepto_asociado_edicion.textContent = texts['concepto-asociado-edicion'];  
        
        var editar_eliminarRelacion = document.getElementById('editar-eliminarRelacion');
        editar_eliminarRelacion.textContent = texts['editar-eliminarRelacion'];
        
        closeSidebar();
        
    }
    
    
     const relaciones1 = [
            { id: 1, name: 'Relación A', conceptos: [{ id: '1', name: 'Concepto A1' }, { id: '2', name: 'Concepto A2' }] },
            { id: 2, name: 'Relación B', conceptos: [{ id: '3', name: 'Concepto B1' }, { id: '4', name: 'Concepto B2' }] },
            { id: 3, name: 'Relación C', conceptos: [{ id: '5', name: 'Concepto C1' }, { id: '6', name: 'Concepto C2' }] },
            { id: 3, name: 'Relación C', conceptos: [{ id: '5', name: 'Concepto C1' }, { id: '6', name: 'Concepto C2' }] },        
     ];

        function mostrarRelacionesDropdown() {
            const input = document.getElementById('buscarRelaciones').value.toLowerCase();
            const dropdown = document.getElementById('relacionesDropdown');
            dropdown.innerHTML = '';

            const filtradas = relaciones1.filter(relacion => relacion.name.toLowerCase().includes(input));
            filtradas.forEach(relacion => {
                const div = document.createElement('div');
                div.className = 'dropdown-item';
                div.textContent = relacion.name;
                div.onclick = () => seleccionarRelacion(relacion);
                dropdown.appendChild(div);
            });
        }

        function seleccionarRelacion(relacion) {
            document.getElementById('buscarRelaciones').value = relacion.name;
            document.getElementById('relacionesDropdown').innerHTML = '';

            const select = document.getElementById('conceptoAsociado');
            select.innerHTML = '';
            relacion.conceptos.forEach(concepto => {
                const option = document.createElement('option');
                option.value = concepto.id;
                option.textContent = concepto.name;
                select.appendChild(option);
            });
        }

        function añadir_Relacion() {
           	const idExpresion = expresion_actual.id;
            const relacionSeleccionada = document.getElementById('buscarRelaciones').value;
            const conceptoSeleccionado = document.getElementById('conceptoAsociado').value;
            
            const relacion = relaciones1.find(rel => rel.name === relacionSeleccionada);
            
            const concepto = relacion.conceptos.find(con => con.id === conceptoSeleccionado);

            const relationDto = {
                relation_id: relacion.id,
                relation_name: relacion.name,
                target_concept_id: concepto.id,
                target_concept_name: concepto.name
            };

            fetch(`http://localhost:8090/expresiones/anadir-relacion/${idExpresion}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(relationDto)
            })
            .then(response => {
            })
            .then(data => {
            	expresion_actual.relations.push(relationDto);
                var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       			dibujarDiagrama(expresion_actual);
       			document.getElementById('expresion-e').innerText = c_grammar;
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al añadir el proyecto');
            });
        }
    
    
    var relacionEliminar;
    
    
    function mostrarPanelTipoEdicion() {
        var selector = document.getElementById("selector-opciones");
        var opcionSeleccionada = selector.value;
        const tipoSemanticoInput = document.getElementById('tipo-semantico');

        var paneles = document.getElementsByClassName("panel-tipoEdicion");
        for (var i = 0; i < paneles.length; i++) {
            paneles[i].style.display = "none";
        }

        var panel = document.getElementById("panel-" + opcionSeleccionada);
        if (panel) {
            panel.style.display = "block";
        }
        
        
      	if (opcionSeleccionada === 'tipo-semantico') {
        	tipoSemanticoInput.value = expresion_actual.semantic_type;
    	}else if(opcionSeleccionada === 'eliminar-relaciones'){
    		const panelEliminarRelaciones = document.getElementById("panel-eliminar-relaciones");
    		const listaRelaciones = document.getElementById("lista-relaciones-eliminar");
    		
    		listaRelaciones.innerHTML = "";
    		    		
    		relacionEliminar=[];
    		
    		expresion_actual.relations.forEach((rel, index) => {
        		const li = document.createElement("li");
        		li.textContent = rel.relation_name;
        		li.className = "list-group-item";
        		li.dataset.index = index;
        		li.onclick = seleccionarEliminarRelacion;
        		listaRelaciones.appendChild(li);
    		});
    	}
        
    }
   
    function seleccionarEliminarRelacion(event) {
    	
    	const index = event.target.dataset.index;
    	relacionEliminar = expresion_actual.relations[index];
    	document.getElementById("concepto-EliminarRelacion").value = relacionEliminar.target_concept_name;
    	
    	document.querySelectorAll('.list-group-item').forEach(item => item.classList.remove('selected'));
    	event.target.classList.add('selected');
  		
	}
	
	function eliminarRelacion() {
	
		const idExpresion = expresion_actual.id;
		
    	const url = `http://localhost:8090/expresiones/borrar-relacion/${idExpresion}`;
    
    	fetch(url, {
        	method: 'PUT',
        	headers: {
            	'Content-Type': 'application/json'
        	},
        	body: JSON.stringify(relacionEliminar)
    	})
    	.then(response => {
        	if (!response.ok) {
            	throw new Error('Error al eliminar la relación');
        	}
        	return response.text();
    	})
    	.then(data => {
        	console.log(`Relación eliminada con éxito: ${data}`);
    	})
    	.catch(error => {
        	console.error('Error al eliminar la relación:', error);
    	});
    	
    	expresion_actual.relations = expresion_actual.relations.filter(relacion => relacion.relation_name !== relacionEliminar.relation_name && relacion.target_concept_name !== relacionEliminar.target_concept_name);
		var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       	dibujarDiagrama(expresion_actual);
       	document.getElementById('expresion-e').innerText = c_grammar;
       	
       	const panelEliminarRelaciones = document.getElementById("panel-eliminar-relaciones");
    	const listaRelaciones = document.getElementById("lista-relaciones-eliminar");
    		
    	listaRelaciones.innerHTML = "";
    		
    	relacionEliminar=[];
    		
    	expresion_actual.relations.forEach((rel, index) => {
        	const li = document.createElement("li");
        	li.textContent = rel.relation_name;
       		li.className = "list-group-item";
       		li.dataset.index = index;
       		li.onclick = seleccionarEliminarRelacion;
       		listaRelaciones.appendChild(li);
    	});
    	
    	document.getElementById('concepto-EliminarRelacion').value = '';
       	
	}
    
    function editarTipoSemantico(){
    	const tipoSemantico = document.getElementById('tipo-semantico').value;
    	const idExpresion = expresion_actual.id;
    	
    	const url = `http://localhost:8090/expresiones/modificar-tipoSemantico/${idExpresion}/${tipoSemantico}`;

    	fetch(url, {
        	method: 'PUT',
        	headers: {
            	'Content-Type': 'application/json'
        	}
    	})
    	.then(response => {
        	if (!response.ok) {
            	throw new Error('Error al modificar el tipo semántico');
       	 	}	
        	return response.text();
    	})
    	.then(data => {
        	console.log('Tipo semántico modificado con éxito:', data);
    	})
    	.catch(error => {
        	console.error('Error:', error);
    	});
    	
    	expresion_actual.semantic_type = tipoSemantico;
    	var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       	dibujarDiagrama(expresion_actual);
       	document.getElementById('expresion-e').innerText = c_grammar;
       	
    }
    
    function changeLanguageDropdown() {
        var languageButton = document.getElementById('language-selector__button');
        var currentLanguage = languageButton.textContent.trim();
        if (currentLanguage === 'Español') {
            changeLanguage('en');
        } else {
            changeLanguage('es');
        }
    }
    
    changeLanguageDropdown();
    
    function openSidebar() {
      document.getElementById("mySidebar").style.left = "0";
      
      obtenerProyectos();
    }
    
    function obtenerProyectos(){
    	
    	const urlParams = new URLSearchParams(window.location.search);
		const email = urlParams.get('email');
		
    	fetch(`http://localhost:8091/usuarios/proyectos/${email}`)
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Error al obtener proyectos');
        })
        .then(data => {
            console.log('Proyectos obtenidos:', data);
            actualizarSidebar(data);
        })
        .catch(error => {
            console.error('Error al obtener proyectos:', error);
            
        });
    }
    
    function añadirMiembros(){
   	  var proyecto_actual = document.getElementById("proyecto_actual").textContent;  	
      document.getElementById("modal-añadirMiembros").style.display = "block";
      document.getElementById("nombreAñadir").value = proyecto_actual;
      document.getElementById("nombreAñadir").disabled = true;
      obtenerUsuarios();
    }

	function cerrarModal_añadir() {
      document.getElementById("modal-añadirMiembros").style.display = "none";
    }
    
    function añadir(){

		var nombreProyecto = document.getElementById("proyecto_actual").textContent;

		const url = `http://localhost:8091/usuarios/proyectos/${encodeURIComponent(nombreProyecto)}`;
		
    	fetch(url, {
    		method: 'POST',
    		headers: {
        		'Content-Type': 'application/json'
    		},
    		body: JSON.stringify(miembrosAñadidosAñadir)
		})
        .then(response => {
            return response.json();
        })
        .then(data => {
        	alert("Miembros Añadidos Correctamente");
        })
        .catch(error => {
           console.error('Error al añadir Usuarios:', error);
        });
    	
    	
    	miembrosAñadidosAñadir=[];
    	
    	miembrosAñadidosDivAñadir.innerHTML = '';
    	
    	selectProject(nombreProyecto);
    	
    	cerrarModal_añadir();
    	closeSidebar();
    }
	
	    
    function selectProject(projectName) {
    	document.getElementById("proyecto_actual").textContent = projectName;
    	
    	const urlParams = new URLSearchParams(window.location.search);
		const email = urlParams.get('email');
		
		const clinicTermList = document.getElementById('clinicTerm-lista');
        
   		clinicTermList.innerHTML = '';
		
		expresiones_edicion = [];
		
    	if(projectName === 'Área Personal' || projectName === 'Personal Area'){
    		obtenerExpresionesPersonales(email);
    	}else{
    		obtenerUsuariosByProyecto(projectName);
    	}
    	closeSidebar();
    	toggleAñadirMiembroButton(projectName);	
    }
    
    function toggleAñadirMiembroButton(projectName) {
      	const añadirMiembroBtn = document.getElementById("añadir_miembro");
      	if (projectName !== 'Área Personal' && projectName !== 'Personal Area') {
      	  añadirMiembroBtn.style.display = 'inline-block';
      	} else {
        	añadirMiembroBtn.style.display = 'none';
      	}
	}
    
    function obtenerExpresionesPersonales(email){
    	const url = `http://localhost:8090/expresiones/usuarios/${email}`;

		
    	fetch(url)
        	.then(response => {
            if (!response.ok) {
                throw new Error('Error al obtener la lista de proyectos');
            }
            return response.json();
        })
        .then(data => {
        		const clinicTermList = document.getElementById('clinicTerm-lista');
        
	
        		data.forEach(e => {
        			expresiones_edicion.push(e);
            		const listItem = document.createElement('li');
            		listItem.textContent = e.clinical_term; 
            		clinicTermList.appendChild(listItem); 
        		});	
        })
        .catch(error => {
           console.error('Error al obtener la lista de Usuarios:', error);
        });
    	
    }
    
    
      window.onload = function() {
     	 const urlParams = new URLSearchParams(window.location.search);
      	const email = urlParams.get('email');

      	if (email) {
        	obtenerExpresionesPersonales(email);
      	} else {
        	console.log('No se proporcionó un correo electrónico');
      	}
      };
      
      var usuariosProyecto = [];

      function obtenerUsuariosByProyecto(projectName) {

          const url = `http://localhost:8091/usuarios/proyectos/usuarios/${projectName}`;

          miembrosAñadidosAñadir = [];
          
          miembrosAñadidosDivAñadir.innerHTML = '';

          fetch(url)
              .then(response => {
                  if (!response.ok) {
                      throw new Error('Error al obtener la lista de proyectos');
                  }
                  return response.json();
              })
              .then(data => {
                  data.forEach(usuario => {
                	  agregarMiembroAñadir(usuario);
                      obtenerExpresionesPersonales(usuario);
                  });    

              })
              .catch(error => {
                  console.error('Error al obtener la lista de Usuarios:', error);
              });
      }
    
    function actualizarSidebar(proyectos) {
        const sidebar = document.getElementById("mySidebar");
        sidebar.innerHTML = '';

        const closeBtn = document.createElement('a');
        closeBtn.href = "javascript:void(0)";
        closeBtn.classList.add('closebtn');
        closeBtn.textContent = '×';
        closeBtn.onclick = closeSidebar;
        sidebar.appendChild(closeBtn);

        const separator2 = document.createElement('div');
        separator2.classList.add('separator_sidebar');
        sidebar.appendChild(separator2);
        
        // Sección Área Personal
        const areaPersonalLink = document.createElement('a');
        areaPersonalLink.href = '#'; 
        var area;
        if(language == 'es'){
        	area = 'Área Personal';
        }else{
        	area = 'Personal Area';
        }
        areaPersonalLink.textContent = area ;
        areaPersonalLink.onclick = () => selectProject(area);
        sidebar.appendChild(areaPersonalLink);
        
        const separator = document.createElement('div');
        separator.classList.add('separator_sidebar');
        sidebar.appendChild(separator);

        // Sección Mis Proyectos
        const misProyectosDetails = document.createElement('details');
        misProyectosDetails.classList.add('mis-proyectos-details');
        
        const misProyectosSummary = document.createElement('summary');
        if(language == 'es'){
        	misProyectosSummary.textContent = 'Mis Proyectos';
        }else{
        	misProyectosSummary.textContent = 'My Project';
        }
        
        misProyectosSummary.id = 'misProyectosSummary';
        misProyectosDetails.appendChild(misProyectosSummary);
        
        misProyectos = misProyectosSummary;
        
        const misProyectosList = document.createElement('ul');
        misProyectosList.classList.add('mis-proyectos-list');
        
        proyectos.forEach((proyecto, index) => {
            
            const listItem = document.createElement('li');
            const separator3 = document.createElement('div');
            separator3.classList.add('separator_sidebar');
            listItem.appendChild(separator3);
            
            
            const link = document.createElement('a');
            link.href = '#'; 
            link.textContent = proyecto;
            link.onclick = () => selectProject(proyecto);
            listItem.appendChild(link);
            
            
            misProyectosList.appendChild(listItem);
        });
        
        misProyectosDetails.appendChild(misProyectosList);
        sidebar.appendChild(misProyectosDetails);
        
        const separator1 = document.createElement('div');
        separator1.classList.add('separator_sidebar');
        sidebar.appendChild(separator1);
        
        // Separador entre Sección Mis Proyectos y Crear Proyecto
        const crearProyectoContainer = document.createElement('div');
        crearProyectoContainer.classList.add('crear-proyecto-container');

        const crearProyectoBtn = document.createElement('button');
        crearProyectoBtn.classList.add('crear-proyecto-btn');
        console.log(language);
        if(language == 'es'){
        	crearProyectoBtn.textContent = 'Crear Proyecto';
        }else{
        	crearProyectoBtn.textContent = 'Create Project';
        }
        crearProyectoBtn.onclick = ver_Proyecto;

        crearProyectoContainer.appendChild(crearProyectoBtn);
        sidebar.appendChild(crearProyectoContainer);
    }

    function closeSidebar() {
      document.getElementById("mySidebar").style.left = "-230px";
    }

	function cerrarModal() {
    	document.getElementById("modal-crearProyecto").style.display = "none";
	}
	

const miembrosAñadidosDiv = document.getElementById('miembrosAñadidos');
const miembrosAñadidosDivAñadir = document.getElementById('miembrosAñadidosAñadir');
var miembrosAñadidos = [];
var miembrosAñadidosAñadir=[];
var miembros=[];

function obtenerUsuarios(){
	const dropdown = document.getElementById("miembrosDropdown");
	
	miembros=[];
	
	fetch('http://localhost:8091/usuarios/todos')
        .then(response => {
            if (!response.ok) {
                throw new Error('La solicitud no pudo ser completada');
            }
            return response.json();
        })
        .then(data => {
            miembrosDropdown.innerHTML = '';
            
            miembros = data;
            
            data.forEach(email => {
            	for(i=0; i<10 ;i=i+1){
            		const option = document.createElement('option');
                    option.value = email;
                    option.textContent = email;
                    miembrosDropdown.appendChild(option);	
            	}
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
}


function ver_Proyecto() {
    document.getElementById("modal-crearProyecto").style.display = "block";
    obtenerUsuarios();
}

function mostrarMiembrosDropdown() {
    const dropdown = document.getElementById("miembrosDropdown");
	
    const buscarMiembrosInput = document.getElementById('buscarMiembros');
    const filtro = buscarMiembrosInput.value.toLowerCase();
    
    var miembrosFiltrados = [];
    
    miembros.forEach(function(miembro) {
        if (miembro.toLowerCase().startsWith(filtro)) {
        	miembrosFiltrados.push(miembro);
        }
    });
    
    
    dropdown.innerHTML = "";
    miembrosFiltrados.forEach(m => {
    	const item = document.createElement('div');
   	    item.textContent = m;
        item.classList.add('miembro-dropdown-item');
  	   	item.onclick = () => agregarMiembro(m);
   	    dropdown.appendChild(item);
   	});
    
   	dropdown.style.display = "block";
}

document.getElementById('buscarMiembros').addEventListener('keyup', function() {
	
    mostrarMiembrosDropdown();
});

// Función para agregar un miembro a la lista de miembros añadidos
function agregarMiembro(miembro) {
	const dropdown = document.getElementById("miembrosDropdown");
    if (!miembrosAñadidosA.includes(miembro)) {
        miembrosAñadidos.push(miembro);
        const miembroAñadidoDiv = document.createElement('div');
        miembroAñadidoDiv.textContent = miembro;
        miembroAñadidoDiv.classList.add('miembro-añadido');
        miembrosAñadidosDiv.appendChild(miembroAñadidoDiv);
    }
    dropdown.style.display = 'none';
}
	function crear(){
		const nombreProyecto = document.getElementById('nombreProyecto').value;
		if(nombreProyecto == null || nombreProyecto == ''){
			alert("Introduce un nombre al proyecto");
			return;
		}
		const miembrosAñadidosElements = document.querySelectorAll('#miembrosAñadidos .miembro-añadido');
		
   		const correosMiembrosAñadidos = [];
		
		const urlParams = new URLSearchParams(window.location.search);
		const email = urlParams.get('email');

    	miembrosAñadidosElements.forEach(element => {
        	correosMiembrosAñadidos.push(element.textContent);
    	});
    		
    	if (!correosMiembrosAñadidos.includes(email)) {
       		correosMiembrosAñadidos.push(email);        
    	}
    	
    	
    	const url = `http://localhost:8091/usuarios/proyectos`;
    	fetch(url, {
        	method: 'POST',
        	headers: {
            	'Content-Type': 'application/json'
        	},
        	body: JSON.stringify({
            	nombre: nombreProyecto,
            	usuarios: correosMiembrosAñadidos
        	})
    	})
    	.then(response => {
        	if (response.ok) {
            	return response.json();
        	}
        	throw new Error('Error al crear el proyecto');
    	})
    	.then(data => {
        	console.log('Proyecto creado con éxito:', data);
    	})
    	.catch(error => {
        	console.error('Error al crear el proyecto:', error);
    	});
    	
    	selectProject(nombreProyecto);
    	document.getElementById("modal-crearProyecto").style.display="none";
    	
	}
	
   	
   	function mostrarMiembrosAñadirDropdown() {
   	    const dropdown = document.getElementById("miembrosDropdown-añadir");
     	const buscarMiembrosInput = document.getElementById('buscarAñadirMiembros');
   	    const filtro = buscarMiembrosInput.value.toLowerCase();
   	    
   	    var miembrosFiltrados = [];
   	    
   	 	dropdown.innerHTML='';
   	    
   	    miembros.forEach(function(miembro) {
   	        if (miembro.toLowerCase().startsWith(filtro)) {
   	        	miembrosFiltrados.push(miembro);
   	        }
   	    });
   	   
   	    miembrosFiltrados.forEach(m => {
   	    	const item = document.createElement('div');
   	   	    item.textContent = m;
   	        item.classList.add('miembro-dropdown-item');
   	  	   	item.onclick = () => agregarMiembroAñadir(m);
   	   	    dropdown.appendChild(item);
   	   	});
   	    
   	   	dropdown.style.display = "block";
   	}
   	
   	document.getElementById('buscarAñadirMiembros').addEventListener('keyup', function() {
   	    mostrarMiembrosAñadirDropdown();
   	});
   	
   	function agregarMiembroAñadir(miembro) {
   		console.log(miembro);
		const dropdown = document.getElementById("miembrosDropdown-añadir");
		
		
    	
	    if (!miembrosAñadidosAñadir.includes(miembro)) {
	        miembrosAñadidosAñadir.push(miembro);
	        const miembroAñadidoDiv = document.createElement('div');
	        miembroAñadidoDiv.textContent = miembro;
	        miembroAñadidoDiv.classList.add('miembro-añadido');
	        miembrosAñadidosDivAñadir.appendChild(miembroAñadidoDiv);
	    }
	    dropdown.style.display = 'none';
	    
	}

   	function validateInput(panelId) {
    	var inputText = document.getElementById('input-text').value;
    	if (inputText.trim().length === 0) {
        	alert('¡Debe ingresar un término clínico!');
        	return false;
    	}
    	changePanel(panelId);

    	if (panelId === 'automatica') {
    		clinicTerm = inputText;
        	generatePostCoordinatedExpression();
        	document.getElementById('texto-mostrado-a').innerText = inputText;
    	} else {
        	document.getElementById('texto-mostrado-g').innerText = inputText;
        	initializeSelect();
    	}

  
}
   	
   	

	function generarExpresionguiada(){
	    const resultado = document.getElementById('resultado1');
		const boton_editar = document.getElementById('boton-editar-2');
		const boton_generar = document.getElementById('boton3');
		const expresion_g = document.getElementById('expresion-g');
		const clinic_term = document.getElementById('texto-mostrado-g').innerText;
		const semantic_type = document.getElementById('tipo-semantico-select').value;
		
		
		var data = {
				clinical_term: clinic_term,
				relations: relacionConceptoMapa,
				semantic_type: semantic_type,
		}
		
		resultado.style.display = "block";
		boton_editar.style.display = "block";
		boton_generar.style.display = "block";
		expresion_g.style.display = "block";
		
		
		
		guardarExpresionGuiada(data);
		
	
		//Generar Expresion PostCoordinada
	}

	
	function togglePanelEdit(){
		var panelEdicion = document.getElementById("panel-right-edicion");
		panelEdicion.style.display = "block";
	
		var modoEdicion = document.getElementById("modo-edicion");
		
		modoEdicion.checked = true;
		
		togglePanel();
		
		expresion_actual = expresiones_edicion[0];
		
		var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       	dibujarDiagrama(expresion_actual);
    	document.getElementById('texto-mostrado-e').innerText = expresion_actual.clinical_term;
    	document.getElementById('expresion-e').innerText = c_grammar;
		
		const clinicTermList = document.getElementById('clinicTerm-lista');
		
		for (let i = 0; i < clinicTermList.children.length; i++) {
    		const listItem = clinicTermList.children[i];
    		
   			if (listItem.textContent.trim() === clinicTerm) {
        		listItem.classList.add('selected');
        		break;
    		}
		}
		
		document.getElementById("selector-opciones").value = "seleccionar";
		document.getElementById("panel-tipo-semantico").style.display = "none";
		document.getElementById("panel-eliminar-relaciones").style.display = "none";
		document.getElementById('concepto-EliminarRelacion').value = '';
	}
	
	function togglePanel() {
    	var modoEdicion = document.getElementById("modo-edicion").checked;
    	var panelEdicion = document.getElementById("panel-edicion");
    	var panelGeneracion = document.getElementById("panel-generacion");

    	if (modoEdicion) {
        	panelEdicion.style.display = "block";
        	panelGeneracion.style.display = "none";
        	browseClinicTerm();
        	
    	} else {
    		panelEdicion.style.display = "none";
        	panelGeneracion.style.display = "block";
    	}
	}

	document.addEventListener("DOMContentLoaded", togglePanel);

	function browseClinicTerm(){
    	const clinicTermList = document.getElementById('clinicTerm-lista');
        
   		clinicTermList.innerHTML = '';
		
		
       	expresiones_edicion.forEach(e => {
    		const listItem = document.createElement('li');
           	listItem.textContent = e.clinical_term; 
           	clinicTermList.appendChild(listItem); 
      	});	
	}
	
	 
    function changePanel(panelId) {
        if (panelId === 'guiada') {
            document.getElementById('panel-right-automatica').style.display = 'none';
            document.getElementById('panel-right-guiada').style.display = 'block';
            document.getElementById('boton-editar-2').style.display = 'none';
            document.getElementById('boton3').style.display = 'none';
            document.getElementById('boton3').style.display = 'none';
            document.getElementById('expresion-g').style.display = 'none';
            document.getElementById('resultado1').style.display = 'none';
        } else {
            document.getElementById('panel-right-automatica').style.display = 'block';
            document.getElementById('panel-right-guiada').style.display = 'none';
            
        }
        
        
    }
    
    function generatePostCoordinatedExpression(){
		const url = 'http://semantics.inf.um.es:5000/generatePostcoordinatedExpression?clinicalTerm='+clinicTerm+'&language='+language;
			
		fetch(url)
        	.then(response => response.json())
        	.then(data => {
        		console.log(data);
        		guardarExpresion(data);
        		
        })
        .catch(error => {
            console.error('Error al obtener la expresión postcoordinada:', error);
        });
	}
	
	function guardarExpresion(data) {
		const urlParams = new URLSearchParams(window.location.search);
		const email = urlParams.get('email');
	
		const url = `http://localhost:8090/expresiones/crear/${email}`;

		fetch(url, {
    		method: 'POST',
    		headers: {
        		'Content-Type': 'application/json'
    		},
    		body: JSON.stringify(data)
		})
		.then(response => {
    		if (!response.ok) {
        		throw new Error('Error en la solicitud: no se pudo crear la expresión');
    		}
    		return response.text();
		})
		.then(id => {
            expresion_actual.id = id;
            expresion_actual.clinical_term = data.clinical_term;
            expresion_actual.relations = data.relations;
            expresion_actual.semantic_type = data.semantic_type;
            expresion_actual.idUsuario = email;
        	expresiones_edicion.push(expresion_actual);
        	console.log(expresion_actual);
       		var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       		dibujarDiagrama(expresion_actual);
       		document.getElementById('expresion').innerText = c_grammar;
		})
		.catch(error => {
    		console.error('Error al crear la expresión:', error);
		});
	}
	
	function guardarExpresionGuiada(data) {
		const urlParams = new URLSearchParams(window.location.search);
		const email = urlParams.get('email');
	
		const url = `http://localhost:8090/expresiones/crear/${email}`;

		fetch(url, {
    		method: 'POST',
    		headers: {
        		'Content-Type': 'application/json'
    		},
    		body: JSON.stringify(data)
		})
		.then(response => {
    		if (!response.ok) {
        		throw new Error('Error en la solicitud: no se pudo crear la expresión');
    		}
    		return response.text();
		})
		.then(id => {
            expresion_actual.id = id;
            expresion_actual.clinical_term = data.clinical_term;
            expresion_actual.relations = data.relations;
            expresion_actual.semantic_type = data.semantic_type;
        	expresiones_edicion.unshift(expresion_actual);
       		var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       		dibujarDiagrama(expresion_actual);
       		console.log(c_grammar);
       		document.getElementById('expresion-g').innerText = c_grammar;
		})
		.catch(error => {
    		console.error('Error al crear la expresión:', error);
		});
	}
	
function convertirAGramaticaComposicional(jsonData) {

	const idRelacion = 116680003;

    const index = jsonData.relations.findIndex(relacion => relacion.relation_id === idRelacion);

    if (index !== -1) {
        const relacionEncontrada = jsonData.relations.splice(index, 1)[0];
        jsonData.relations.unshift(relacionEncontrada);
    }
    

    const { clinical_term, semantic_type, relations } = jsonData;
    
    let compositionalGrammar = `===  ${clinical_term} |${semantic_type}|`;

     const relationGroups = relations.reduce((acc, relation) => {
        if (!acc[relation.relation_name]) {
            acc[relation.relation_name] = [];
        }
        acc[relation.relation_name].push(relation);
        return acc;
    }, {});

    compositionalGrammar += " :\n";
    
    var languageButton = document.getElementById('language-selector__button');
        var currentLanguage = languageButton.textContent.trim();
		var atributo;  
        if (currentLanguage === 'Español') {
            atributo='atributo';
        } else {
            atributo='attribute';
        }

    Object.entries(relationGroups).forEach(([relationName, relations]) => {
        compositionalGrammar += `{ ${relations[0].relation_id} |${relationName} (${atributo})| `;
        relations.forEach((relation, index) => {
            compositionalGrammar += ` = ${relation.target_concept_id} |${relation.target_concept_name}| `;
            if (index < relations.length - 1) {
                compositionalGrammar += ", ";
            }
        });
        compositionalGrammar += " } \n";
    });
    
    return compositionalGrammar;
}
    
    function identifySemanticType(){
		const url = 'http://semantics.inf.um.es:5000/identifySemanticType?clinicalTerm='+clinicTerm+'&language='+language;
		
		
		fetch(url)
        	.then(response => response.json())
        	.then(data => {
        		var select = document.getElementById("tipo-semantico-select");
        		let firstOption = select.options[0];

				select.innerHTML = '';
				select.appendChild(firstOption);

    			const { semantic_types } = data;
    			
    			
    			semantic_types.forEach(type => {
    				let option = document.createElement('option');
    				option.value = type;
    				option.text = type;
    				select.appendChild(option);
				});
        })
        .catch(error => {
            console.error('Error al obtener la expresión postcoordinada:', error);
        });
	}
	
	 function identifyReferenceConcept(){
    	
		const url = 'http://semantics.inf.um.es:5000/identifyReferenceConcept?clinicalTerm='+clinicTerm+'&language='+language+'&semanticType='+semanticType;
		
		
		fetch(url)
        	.then(response => response.json())
        	.then(data => {
        		
        		
        		var select = document.getElementById("concepto-referencia-select");
        		let firstOption = select.options[0];

				select.innerHTML = '';
				select.appendChild(firstOption);

    			const { reference_concepts } = data;
    			
    			
    			reference_concepts.forEach(type => {
    				
    				const url2 = 'http://semantics.inf.um.es:5000/getName?=conceptID'+type+'&language='+language;
    				
    				fetch(url)
    		        	.then(response => response.json())
    		        	.then(data => {
    		        		console.log("HJIOLAA");
    		        		console.log(type);
    		        		console.log(data);
    		        })
    		        .catch(error => {
    		            console.error('Error al obtener la expresión postcoordinada:', error);
    		        });
    				
    				let option = document.createElement('option');
    				option.value = type;
    				option.text = type;
    				select.appendChild(option);
        		})
        })
        .catch(error => {
            console.error('Error al obtener la expresión postcoordinada:', error);
        });
	}
    
function initializeSelect(){
 	var tipoSemanticoSelect = document.getElementById("tipo-semantico-select");
    var referenciaSelect = document.getElementById("concepto-referencia-select");
 	var inputText = document.getElementById('input-text').value;
    
    tipoSemanticoSelect.value = "seleccion";
    referenciaSelect.disabled = true;
    referenciaSelect.value = "seleccion1";
    
    document.getElementById("relacion-lista").innerHTML = "";
    document.getElementById("concepto-lista").innerHTML = "";
    relacionConceptoMapa = [];
    
    clinicTerm = inputText;
    
    identifySemanticType();
}

var relacionSeleccionada;
var relacionConceptoMapa;

    
function habilitarReferencia() {
	var boton_generar = document.getElementById("boton-generar-e");
	var resultado = document.getElementById("resultado1");
	var boton_editar = document.getElementById("boton-editar-2");
	var boton_diagrama = document.getElementById("boton3");
    var tipoSemantico = document.getElementById("tipo-semantico-select").value;
    var referenciaSelect = document.getElementById("concepto-referencia").getElementsByTagName('select')[0];
    
    if (tipoSemantico === "seleccion") {
        referenciaSelect.disabled = true;
        referenciaSelect.value = "seleccion1";
        
    } else {
        referenciaSelect.disabled = false;
        referenciaSelect.value = "seleccion1";
        semanticType = tipoSemantico;
        identifyReferenceConcept();
    }
    
    document.getElementById("relacion-lista").innerHTML = "";
    document.getElementById("concepto-lista").innerHTML = "";
    relacionConceptoMapa = [];
    boton_generar.style.display = "none";
    resultado1.style.display = "none";
    boton_editar.style.display = "none";
    boton_diagrama.style.display = "none";
    
    
}


const relaciones = [
    {
        relation_id: 1,
        relation_name: 'Relacion A',
        target_concept_id: 1001,
        target_concept_name: 'Concepto 1'
    },
    {
        relation_id: 2,
        relation_name: 'Relacion A',
        target_concept_id: 1002,
        target_concept_name: 'Concepto 2'
    },
    {
        relation_id: 3,
        relation_name: 'Relacion A',
        target_concept_id: 1003,
        target_concept_name: 'Concepto 3'
    },
    {
        relation_id: 4,
        relation_name: 'Relacion B',
        target_concept_id: 1004,
        target_concept_name: 'Concepto 4'
    },
    {
        relation_id: 5,
        relation_name: 'Relacion B',
        target_concept_id: 1005,
        target_concept_name: 'Concepto 5'
    },
    {
        relation_id: 6,
        relation_name: 'Relacion C',
        target_concept_id: 1006,
        target_concept_name: 'Concepto 6'
    },
    {
        relation_id: 7,
        relation_name: 'Relacion C',
        target_concept_id: 1007,
        target_concept_name: 'Concepto 7'
    },
    {
        relation_id: 8,
        relation_name: 'Relacion C',
        target_concept_id: 1008,
        target_concept_name: 'Concepto 8'
    },
    {
        relation_id: 9,
        relation_name: 'Relacion D',
        target_concept_id: 1009,
        target_concept_name: 'Concepto 9'
    },
    {
        relation_id: 10,
        relation_name: 'Relacion E',
        target_concept_id: 1010,
        target_concept_name: 'Concepto 10'
    },
    {
        relation_id: 11,
        relation_name: 'Relacion E',
        target_concept_id: 1011,
        target_concept_name: 'Concepto 11'
    }
];
        
function habilitarRelacion() {
	
	var referencia = document.getElementById("concepto-referencia-select").value;
    
	console.log(referencia);
	
	const url = 'http://localhost:8080/MAIN/relationships?source=725655004&offset=0&limit=50';
    
	console.log(url);
	
	fetch(url)
    .then(response => {
        if (response.ok) {
            return response.json();
        }
        throw new Error('Error al obtener proyectos');
    })
    .then(data => {
        console.log('Proyectos obtenidos:', data);
        actualizarSidebar(data);
    })
    .catch(error => {
        console.error('Error al obtener proyectos:', error);
        
    });
	
	const agrupadoPorRelacion = relaciones.reduce((acumulador, actual) => {
	    const {relation_id, relation_name, target_concept_id, target_concept_name } = actual;

	    if (!acumulador[relation_name]) {
	        acumulador[relation_name] = {
	        	relation_id: relation_id,
	            relation_name: relation_name,
	            conceptos: []
	        };
	    }

	    acumulador[relation_name].conceptos.push({
	        target_concept_id,
	        target_concept_name
	    });

	    return acumulador;
	}, {});

	const resultado1 = Object.values(agrupadoPorRelacion);
	
	
	var resultado = document.getElementById("resultado1");
	var boton_editar = document.getElementById("boton-editar-2");
	var boton_diagrama = document.getElementById("boton3");
    var boton_generar = document.getElementById("boton-generar-e");
     
   	if (referencia === "seleccion1") {
    	document.getElementById("relacion-lista").innerHTML = "";
    	document.getElementById("concepto-lista").innerHTML = "";
    	var relacionConceptoMapa = [];
    	boton_generar.style.display = "none";
    	
    } else {

        var relacionLista = document.getElementById("relacion-lista");
		relacionLista.innerHTML = "";

		console.log(resultado1);
		
		resultado1.forEach(relacion => {
    		var li = document.createElement("li");
    		li.textContent = relacion.relation_name; 
    		li.onclick = function() {
    			relacionSeleccionada = relacion;
        		habilitarConceptos(relacion.conceptos);
    		};
    		relacionLista.appendChild(li);
		});
        boton_generar.style.display = "block";
    }
    
    resultado.style.display = "none";
    boton_editar.style.display = "none";
    boton_diagrama.style.display = "none";
    
}

function guardarSeleccion() {
    var conceptosSeleccionados = [];
    var checkboxes = document.querySelectorAll("#concepto-checkboxes input[type='checkbox']:checked");

     checkboxes.forEach(function(checkbox) {
        conceptosSeleccionados.push(checkbox.value);
    });
}

function habilitarConceptos(conceptos) {
    var listaConceptos = document.getElementById("concepto-lista");
    var tituloConceptos = document.getElementById("titulo7");
    
    
    listaConceptos.innerHTML = ""; // Limpiar la lista actual de conceptos

    // Iterar sobre los conceptos y agregar cada uno como un checkbox
    conceptos.forEach(concepto => {
    	var li = document.createElement("li");
    	var radio = document.createElement("input");
    	radio.type = "radio"; 
    	radio.name = "concepto"; 
    	radio.value = concepto.target_concept_name;
    	radio.addEventListener('change', function() {
        	conceptoSeleccionado(concepto);
    	});
    	
    	if (relacionConceptoMapa.length > 0) {
    	    relacionConceptoMapa.forEach((relacion) => {
    	        if (relacion.target_concept_name === concepto.target_concept_name) {
    	           radio.checked = true;
    	        }
    	    });
    	}
    	
    	li.appendChild(radio);
    	li.appendChild(document.createTextNode(concepto.target_concept_name));
    	listaConceptos.appendChild(li);
	});
}

function conceptoSeleccionado(concepto) {

	console.log(concepto);
	var relaciones = document.querySelectorAll('#relacion-lista li');
    
    relaciones.forEach(function(relacion) {
        if (relacion.textContent.trim() === relacionSeleccionada.relation_name) {
            relacion.classList.add('selected');
        }
    });
    
    if (relacionSeleccionada) {
    	relacionConceptoMapa = relacionConceptoMapa.filter(item => 
        	item.relation_id !== relacionSeleccionada.relation_id || 
        	item.relation_name !== relacionSeleccionada.relation_name
    	);
    	let item = {
    		    relation_id: relacionSeleccionada.relation_id,
    		    relation_name: relacionSeleccionada.relation_name,
    		    target_concept_id: concepto.target_concept_id,
    		    target_concept_name: concepto.target_concept_name
    		};
    	relacionConceptoMapa.push(item);
    	console.log(relacionConceptoMapa);
    }
   
}

function borrarTodoMapa() {
    relacionConceptoMapa = [];
    
    var relaciones = document.querySelectorAll('#relacion-lista li');
    
    relaciones.forEach(function(relacion) {
            relacion.classList.remove('selected');
    });
    
    var conceptoLista = document.getElementById("concepto-lista");
    if (conceptoLista) {
       var checkboxes = conceptoLista.querySelectorAll("input[type='radio']");
       checkboxes.forEach(function(checkbox) {
            checkbox.checked = false;               
       });
    }
}

function borrarEntradaRelacion() {
    if (relacionSeleccionada) {
    	relacionConceptoMapa = relacionConceptoMapa.filter(item => 
        item.relation_id !== relacionSeleccionada.relation_id || 
        item.relation_name !== relacionSeleccionada.relation_name
    );
        
        var relaciones = document.querySelectorAll('#relacion-lista li');
        
    	relaciones.forEach(function(relacion) {
    		if (relacion.textContent.trim() === relacionSeleccionada.relation_name) {
            	relacion.classList.remove('selected');
            	
        	}
    	});
    	var conceptoLista = document.getElementById("concepto-lista");
       	if (conceptoLista) {
            var checkboxes = conceptoLista.querySelectorAll("input[type='radio']");
           	checkboxes.forEach(function(checkbox) {
                  checkbox.checked = false;    
           	});
        }
    } else {
        console.log("No hay relación seleccionada para borrar.");
    }
}

document.addEventListener("DOMContentLoaded", function() {
    const clinicTermList = document.getElementById('clinicTerm-lista');
    
    
    clinicTermList.addEventListener("click", function(event) {
        if (event.target.tagName === "LI") {
        	document.getElementById("selector-opciones").value = "seleccionar";
        	mostrarPanelTipoEdicion();
            
            const selectedItems = clinicTermList.querySelectorAll('.selected');
            selectedItems.forEach(item => {
                item.classList.remove('selected');
            });

            const selectedTerm = event.target.textContent;
            
            var panelEdicion = document.getElementById("panel-right-edicion");
			panelEdicion.style.display = "block";
			
			const listaItems = Array.from(clinicTermList.querySelectorAll('li'));
    		const indice = listaItems.indexOf(event.target);
			
			expresion_actual = expresiones_edicion[indice];
			
			document.getElementById('texto-usuario-e').innerText = expresion_actual.id_usuario;
			
			var c_grammar = convertirAGramaticaComposicional(expresion_actual);
       		dibujarDiagrama(expresion_actual);
    		document.getElementById('texto-mostrado-e').innerText = expresion_actual.clinical_term;
    		document.getElementById('expresion-e').innerText = c_grammar;
            
            event.target.classList.add('selected');
            
            document.getElementById('concepto-EliminarRelacion').value = '';
           	
        }
    });
});




</script>

<script>

function groupWords(words) {
  const lines = [];
  let currentLine = [];
  let currentLength = 0;

  words.forEach(word => {
    if (word.length > 14) {
      if (currentLine.length > 0) {
        lines.push(currentLine.join(' '));
        currentLine = [];
        currentLength = 0;
      }
      lines.push(word);
    } else {
      if (currentLength + word.length + (currentLine.length > 0 ? 1 : 0) <= 14) {
        currentLine.push(word);
        currentLength += word.length + (currentLine.length > 1 ? 1 : 0);
      } else {
        lines.push(currentLine.join(' '));
        currentLine = [word];
        currentLength = word.length;
      }
    }
  });

  if (currentLine.length > 0) {
    lines.push(currentLine.join(' '));
  }

  return lines;
}

function dibujarDiagrama(jsonData) {

	const modalBody = d3.select('#myModal .modal-body');

	modalBody.html('');

	const svg = modalBody.append('svg')
  	.attr('width', 800)
  	.attr('height', 500);

	const nodoCentral = svg.append('g')
  	.attr('class', 'nodo-central')
  	.attr('transform', 'translate(460, 250)');

	function groupWords(words) {
	  	const lines = [];
 		let currentLine = [];
  		let currentLength = 0;

  		words.forEach(word => {
    		if (word.length > 14) {
      			if (currentLine.length > 0) {
        			lines.push(currentLine.join(' '));
        			currentLine = [];
        			currentLength = 0;
      			}
      			lines.push(word);
    		} else {
     	 		if (currentLength + word.length + (currentLine.length > 0 ? 1 : 0) <= 14) {
        			currentLine.push(word);
        			currentLength += word.length + (currentLine.length > 1 ? 1 : 0);
      			} else {
        		lines.push(currentLine.join(' '));
        		currentLine = [word];
        		currentLength = word.length;
      		}
    	}
  	});

  	if (currentLine.length > 0) {
    	lines.push(currentLine.join(' '));
  	}

  	return lines;
}

let rx;
let ry;
const clinicalTermLines = groupWords(jsonData.clinical_term.split(' '));
const semanticTypeLines = groupWords(jsonData.semantic_type.split(' '));

const totalLines = clinicalTermLines.length + semanticTypeLines.length;

rx = 70, ry = 40;

const allWords = [...String(jsonData.clinical_term).split(' '), ...String(jsonData.semantic_type).split(' ')];
allWords.forEach(word => {
  if (word.length > 14) {
    rx += (word.length - 14) * 5;
  }
});

if (totalLines >= 5) {
  const extraSize = (totalLines - 4) * 10;
  ry += extraSize;
}

nodoCentral.append('ellipse')
  .attr('rx', rx)
  .attr('ry', ry)
  .style('fill', 'white')
  .style('stroke', 'black')
  .style('stroke-width', '2');

const termText = nodoCentral.append('text')
  .attr('text-anchor', 'middle')
  .style('fill', 'black')
  .style('font-weight', 'bold');

clinicalTermLines.forEach((line, i) => {
  termText.append('tspan')
    .attr('x', 0)
    .attr('y', i * 13 - (clinicalTermLines.length * 8) / 2)
    .text(line);
});

const typeText = nodoCentral.append('text')
  .attr('text-anchor', 'middle')
  .style('fill', 'black')
  .style('font-size', '12px');

semanticTypeLines.forEach((line, i) => {
  typeText.append('tspan')
    .attr('x', 0)
    .attr('y', (clinicalTermLines.length * 8) + (i * 8) + 6)
    .text(line);
});



const numRelaciones = jsonData.relations.length;
const radio = 205;
const anguloInicial = -Math.PI / 2;
const anguloIncremento = (2 * Math.PI) / numRelaciones;

const nodos = jsonData.relations.map((relation, index) => ({
  id: relation.relation_id,
  name: relation.relation_name,
  label: relation.target_concept_name,
  targetId: relation.target_concept_id,
  x: 460 + 1.3 * radio * Math.cos(anguloInicial + index * anguloIncremento),
  y: 250 + radio * Math.sin(anguloInicial + index * anguloIncremento),
  rx:0,
  ry:0
}));

const relationNodes = svg.selectAll('g.relation')
  .data(nodos)
  .enter()
  .append('g')
  .attr('class', 'relation')
  .attr('transform', d => {
  
	const newX = d.x;
	const newY = d.y;

	return `translate(${newX}, ${newY})`;
  });

// Dibuja las etiquetas de los nodos de las relaciones
relationNodes.each(function(d) {
  const group = d3.select(this);

  const labelLines = groupWords(String(d.label).split(' '));
  const targetIdLines = groupWords(String(d.targetId).split(' '));

  const totalLines = labelLines.length + targetIdLines.length;
  
  let rx = 70, ry = 40;
  if (totalLines >= 4) {
    const extraSize = (totalLines - 4) * 11;
    rx += extraSize;
    ry += extraSize;
  }
  
  const allWords = [...String(d.label).split(' '), ...String(d.targetId).split(' ')];
  allWords.forEach(word => {
    if (word.length > 14) {
      rx += (word.length - 14) * 8;
    }
  });

 group.append('ellipse')
  	.attr('x', d.x+rx)
  	.attr('y', d.y+ry)
    .attr('rx', rx)
    .attr('ry', ry)
    .style('fill', 'white')
    .style('stroke', 'black')
    .style('stroke-width', '2');
	
  const labelText = group.append('text')
    .attr('text-anchor', 'middle')
    .style('fill', 'black')
    .style('font-weight', 'bold');

  labelLines.forEach((line, i) => {
    labelText.append('tspan')
      .attr('x', 0)
      .attr('y', i * 13 - (labelLines.length * 8) / 2)
      .text(line);
  });

  // Renderizar cada línea del targetId
  const targetIdText = group.append('text')
    .attr('text-anchor', 'middle')
    .style('fill', 'black')
    .style('font-size', '12px');

  targetIdLines.forEach((line, i) => {
    targetIdText.append('tspan')
      .attr('x', 0)
      .attr('y', (labelLines.length * 8) + (i * 8) + 6)
      .text(line);
  });
});


var angulo;

const enlaces = jsonData.relations.map((relation, index) => {
  const nodo = nodos[index];
  
  
  angulo = Math.atan2(nodo.y - 250, nodo.x - 460);
  const startX = 460 + rx * Math.cos(angulo);
  const startY = 250 + ry * Math.sin(angulo);

  const dx = nodo.x - 460;
  const dy = nodo.y - 250;
  const dist = Math.sqrt(dx * dx + dy * dy);
  const endX = 460 + (dx * (dist - nodo.rx)) / dist;
  const endY = 250 + (dy * (dist - nodo.ry)) / dist;

  const refX = 15 * Math.abs(Math.cos(angulo));
  
  return {
    source: { x: startX, y: startY },
    target: { x: nodo.x, y: nodo.y },
    name: relation.relation_name,
    id: relation.relation_id,
    refX: refX
  };
});

const linkGroup = svg.selectAll('g.link')
  .data(enlaces)
  .enter()
  .append('g')
  .attr('class', 'link');
  
  
linkGroup.append('line')
    .attr('x1', d => d.source.x)
    .attr('y1', d => d.source.y)
    .attr('x2', d => {
        const dx = d.target.x - d.source.x;
        const dy = d.target.y - d.source.y;
        const length = Math.sqrt(dx * dx + dy * dy);
        const offsetX = (dx / length) * (length - 70);
        return d.source.x + offsetX;
    })
    .attr('y2', d => {
        const dx = d.target.x - d.source.x;
        const dy = d.target.y - d.source.y;
        const length = Math.sqrt(dx * dx + dy * dy);
        const offsetY = (dy / length) * (length - 50);
        return d.source.y + offsetY;
    })
    .attr('marker-end', (d, i) => `url(#arrowhead-${i})`)
    .style('stroke', 'black');

linkGroup.append('text')
    .attr('x', function(d) {
        const offsetX = (d.source.x + d.target.x) / 2;
        const directionX = d.source.x < d.target.x ? 1 : -1;
        return offsetX + directionX * 35;
    })
    .attr('y', function(d) {
        const offsetY = (d.source.y + d.target.y) / 2;
        const directionY = d.source.y < d.target.y ? 1 : -1;
        return offsetY - directionY * 40; // Adjust this value as needed
    }) 
    .attr('dy', 5)
    .attr('text-anchor', 'middle')
    .text(d => `${d.name}`)
    .style('fill', 'black')
    .style('font-size', '12px')
    .style('font-weight', 'bold');
    
linkGroup.append('text')
    .attr('x', function(d) {
        const offsetX = (d.source.x + d.target.x) / 2;
        const directionX = d.source.x < d.target.x ? 1 : -1;
        return offsetX + directionX * 35;
    })
    .attr('y', function(d) {
        const offsetY = (d.source.y + d.target.y) / 2;
        const directionY = d.source.y < d.target.y ? 1 : -1;
        return offsetY - directionY * 40 + 15; // Adjust this value as needed
    }) 
    .attr('dy', 5)
    .attr('text-anchor', 'middle')
    .text(d => `(${d.id})`)
    .style('fill', 'black')
    .style('font-size', '12px');


  
// Define la flecha para la punta del enlace
svg.append('defs').selectAll('marker')
    .data(enlaces)
    .enter()
    .append('marker')
    .attr('id', (d, i) => `arrowhead-${i}`)
    .attr('viewBox', '-0 -5 10 10')
    .attr('refX', 10)
    .attr('refY', 0)
    .attr('orient', 'auto')
    .attr('markerWidth', 20)
    .attr('markerHeight', 20)
    .attr('xoverflow', 'visible')
    .append('svg:path')
    .attr('d', 'M 0,-5 L 10 ,0 L 0,5')
    .attr('fill', '#000');


}
	

</script>

</body>
</html>